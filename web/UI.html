<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Transcript Parser</title>
</head>
<body>

<h2>Transcript Parser</h2>
<p>Reads transcripts from remote interviews and extracts the dialog between participants</p>

<form id="form1">
    <div class="input-group">
        <label>New study name: <input type="text" id="studyname" name="studyname"/></label>
        <button value="study" type="submit">Create Study</button><br>
    </div>
</form>

<pre id="study_id"></pre>

<form id="form11">
    <div class="input-group">
        <p>Or select from an existing study:
        <select name = "ExisingStudies" size = "4" multiple>
            <option>Study1</option>
            <option>Study2</option>
        </select>
        <button value="study" type="submit">Select Study</button><br>
        </p>
    </div>
</form>



<form id="form2">
    <div class="input-group">
        <label>File name: <input type="text" id="filename" name="filename"/></label>
        <button value="file" type="submit">Get Transcript</button>
    </div>
</form>

<h2>Transcript Content</h2>
<pre id="transcript_content"></pre>
<hr>

<h3>Parsed Dialog</h3>
<p>Removes extra lines, numbers and timestamps.  Extract the speakers and their dialog and saves
    to text file and in the database for leater retrieval.</p>

<form id="form3">
    <div class="input-group">
        <label>Output file (*.txt): <input type="text" id="output_filename" name="output_filename"/></label>
        <button value="dialog" type="submit">Parse and Save</button>
    </div>
</form>

<h2>Parsed Dialog</h2>
<pre id="parsed_dialog"></pre>
</body>

<script>
async function handleSubmit1(event) {
    event.preventDefault();

    const data = new FormData(event.target);
    const value = Object.fromEntries(data.entries());
    value.studyname = data.get("studyname");
    console.log({value});

    const response = await fetch('http://localhost:5000/checkifstudyexists', {
        method: 'POST',
        body: JSON.stringify(value),    // sent as json to the endpoint
        headers: {
            'Content-Type': 'application/json',
            }
        });
    const myJson = await response.json();
    console.log(myJson);
    document.getElementById('study_id').textContent = JSON.stringify(myJson, undefined, 2);
}
const form1 = document.getElementById("form1");
form1.addEventListener("submit", async (e) => handleSubmit1(e), false);

async function handleSubmit2(event) {
    event.preventDefault();

    const data = new FormData(event.target);
    const value = Object.fromEntries(data.entries());
    value.filename = data.get("filename");
    console.log({value});

    const response = await fetch('http://localhost:5000/file', {
        method: 'POST',
        body: JSON.stringify(value),
        headers: {
            'Content-Type': 'application/json',
            }
        });
    const myJson = await response.json();
    console.log(myJson);
    document.getElementById('transcript_content').textContent = JSON.stringify(myJson, undefined, 2);
}
const form2 = document.getElementById("form2");
form2.addEventListener("submit", async (e) => handleSubmit2(e), false);

async function handleSubmit3(event) {
    event.preventDefault();

    const data = new FormData(event.target);
    const value = Object.fromEntries(data.entries());
    value.filename = data.get("output_filename");
    console.log({value});

    const response = await fetch('http://localhost:5000/dialog', {
        method: 'POST',
        body: JSON.stringify(value),
        headers: {
            'Content-Type': 'application/json',
            }
        });
    const myJson = await response.json();
    console.log(myJson);
    document.getElementById('parsed_dialog').textContent = JSON.stringify(myJson, undefined, 2);
}
const form3 = document.getElementById("form3");
form2.addEventListener("submit", async (e) => handleSubmit2(e), false);
</script>


</script>



</html>
